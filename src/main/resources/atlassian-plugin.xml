<atlassian-plugin key="${atlassian.plugin.key}" name="${project.name}" plugins-version="2">
    <plugin-info>
        <description>${project.description}</description>
        <version>${project.version}</version>
        <vendor name="${project.organization.name}" url="${project.organization.url}" />
        <param name="plugin-icon">images/icon.png</param>
        <param name="plugin-logo">images/logo.png</param>
    </plugin-info>

    <!-- add our i18n resource -->
    <resource type="i18n" name="i18n" location="jira-scm-plugin"/>

    <!-- add our web resources -->
    <web-resource key="jira-scm-plugin-resources" name="jira-scm-plugin Web Resources">
        <dependency>com.atlassian.auiplugin:ajs</dependency>

        <resource type="download" name="jira-scm-plugin.css" location="/css/jira-scm-plugin.css"/>
        <resource type="download" name="jira-scm-plugin.js" location="/js/jira-scm-plugin.js"/>
        <resource type="download" name="images/" location="/images"/>

        <!--context>jira-scm-plugin</context-->
        <context>atl.general</context>
    </web-resource>

    <!-- https://developer.atlassian.com/server/jira/platform/web-panel/ -->

    <!-- project settings -->

    <web-item key="jira-scm-plugin-settings" name="SCM-Settings" section="atl.jira.proj.config/projectgroup4" weight="200">
        <description key="item-2.description">Settings for SCM-Manager integration</description>
        <label key="SCM-Manager Integration" />
        <link linkId="item-2-link">/plugins/servlet/scm-manager/settings?project=$projectKeyEncoded</link>
    </web-item>

    <servlet key="scm-project-settings-servlet" class="com.cloudogu.scm.impl.ProjectSettingsServlet">
        <url-pattern>/scm-manager/settings</url-pattern>
    </servlet>

    <!-- issue actions -->
    <!--
    Ajax Dialog
    https://developer.atlassian.com/server/jira/platform/creating-an-ajax-dialog/
    -->

    <web-section key="scmm-section" name="SCM-Manager Section" location="opsbar-operations" weight="65">
        <conditions type="and">
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.UserLoggedInCondition" />
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.IsIssueEditableCondition" />
            <condition class="com.atlassian.jira.plugin.webfragment.conditions.HasIssuePermissionCondition">
                <param name="permission" value="edit"/>
            </condition>
            <condition class="com.cloudogu.scm.impl.IsConfiguredCondition" />
        </conditions>
    </web-section>

    <web-item key="scmm-connect-branch" name="SCM-Manager connect branch" section="scmm-section" weight="10">
        <label>Connect SCM-Manager Branch</label>
        <link linkId="scmm-connect-branch-link">/secure/ConnectBranchAction!default.jspa?id=${issue.id}</link>
    </web-item>

    <!-- use link dialog
         https://developer.atlassian.com/server/jira/platform/creating-a-custom-issue-link-dialog-for-remote-issue-links/
    <web-item key="scmm-connect-branch-a-link" section="create-issue-link-types" weight="100">
        <label key="scmm-connect-branch-a.label" />
        <link linkId="scmm-connect-branch-a-link">
            /secure/ConnectBranchAction!default.jspa?id=${issueId}
        </link>
    </web-item>
    -->

    <webwork1 key="scmm-connect-branch-webwork-module" name="SCM-Manager Connect Branch Webwork Module">
        <description key="scmm-connect-branch-webwork-module.description">Connect SCM-Manager Branch</description>
        <actions>
            <action name="com.cloudogu.scm.impl.ConnectBranchAction" alias="ConnectBranchAction">
                <view name="input">/templates/connect-branch.vm</view>
                <view name="error">/templates/connect-branch.vm</view>
            </action>
        </actions>
    </webwork1>

</atlassian-plugin>
